<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="DTL">
<meta name="dcterms.date" content="2026-02-15">

<title>CvH Proteomics — Imputation Pipeline</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="CvH_imputation_files/libs/clipboard/clipboard.min.js"></script>
<script src="CvH_imputation_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="CvH_imputation_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="CvH_imputation_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="CvH_imputation_files/libs/quarto-html/popper.min.js"></script>
<script src="CvH_imputation_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="CvH_imputation_files/libs/quarto-html/anchor.min.js"></script>
<link href="CvH_imputation_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="CvH_imputation_files/libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="CvH_imputation_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="CvH_imputation_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="CvH_imputation_files/libs/bootstrap/bootstrap-82a8e0681529fff444bbc39736ff6b3a.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-setup" id="toc-sec-setup" class="nav-link active" data-scroll-target="#sec-setup">0 – Setup</a></li>
  <li><a href="#sec-intro" id="toc-sec-intro" class="nav-link" data-scroll-target="#sec-intro">1 – Introduction: The Missing Data Problem in DIA-MS</a></li>
  <li><a href="#sec-classification" id="toc-sec-classification" class="nav-link" data-scroll-target="#sec-classification">2 – MAR/MNAR Classification</a></li>
  <li><a href="#sec-benchmark-design" id="toc-sec-benchmark-design" class="nav-link" data-scroll-target="#sec-benchmark-design">3 – Benchmark Design and Rationale</a></li>
  <li><a href="#sec-benchmark-results" id="toc-sec-benchmark-results" class="nav-link" data-scroll-target="#sec-benchmark-results">4 – Benchmark Results and Interpretation</a></li>
  <li><a href="#sec-audit" id="toc-sec-audit" class="nav-link" data-scroll-target="#sec-audit">5 – Imputation Quality Audit</a></li>
  <li><a href="#sec-conclusion" id="toc-sec-conclusion" class="nav-link" data-scroll-target="#sec-conclusion">6 – Conclusion</a></li>
  <li><a href="#sec-refs" id="toc-sec-refs" class="nav-link" data-scroll-target="#sec-refs">References</a></li>
  <li><a href="#sec-session" id="toc-sec-session" class="nav-link" data-scroll-target="#sec-session">Session Info</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">CvH Proteomics — Imputation Pipeline</h1>
<p class="subtitle lead">MAR/MNAR Classification, Benchmark, and Quality Audit</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>DTL </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 15, 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="sec-setup" class="level1">
<h1>0 – Setup</h1>
<p>This document presents the results of the CvH imputation pipeline. It does not execute the imputation analysis itself — the companion script <code>CvH_imputation_run.R</code> produces all data outputs and report PDFs. This narrative document reads those outputs and contextualizes them within the proteomics literature on missing data handling. All code chunks are display-only: they read pre-computed CSV files and generate tables or figures. No imputation computation is performed here.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"pacman"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(readr, dplyr, tidyr, knitr, ggplot2, patchwork, here, scales)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Paths to pre-computed outputs from CvH_imputation_run.R</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>data_dir   <span class="ot">&lt;-</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">"02_Imputation"</span>, <span class="st">"c_data"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>report_dir <span class="ot">&lt;-</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">"02_Imputation"</span>, <span class="st">"b_reports"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>norm_dir   <span class="ot">&lt;-</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">"01_normalization"</span>, <span class="st">"c_data"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>meta_path  <span class="ot">&lt;-</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">"00_input"</span>, <span class="st">"CvH_meta.csv"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Palettes consistent with the R script</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>pal_mar <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">MAR =</span> <span class="st">"#4393C3"</span>, <span class="at">MNAR =</span> <span class="st">"#D6604D"</span>, <span class="at">Complete =</span> <span class="st">"#999999"</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>pal_typ <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">MNAR =</span> <span class="st">"#D6604D"</span>, <span class="at">MAR =</span> <span class="st">"#4393C3"</span>, <span class="at">Hybrid =</span> <span class="st">"#5AAE61"</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>pal_donut <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">Complete =</span> <span class="st">"#999999"</span>, <span class="at">MAR =</span> <span class="st">"#4393C3"</span>, <span class="at">MNAR =</span> <span class="st">"#D6604D"</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>pal_bio <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">CR_T1 =</span> <span class="st">"#1B9E77"</span>, <span class="at">CR_T2 =</span> <span class="st">"#D95F02"</span>, <span class="at">PPS_T1 =</span> <span class="st">"#7570B3"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="sec-intro" class="level1">
<h1>1 – Introduction: The Missing Data Problem in DIA-MS</h1>
<p>Missing values are pervasive in label-free quantitative proteomics. A typical DIA-MS intensity matrix retains 5–20% missing entries even after quality filtering, and the manner in which those gaps are handled directly affects fold changes, variance estimates, p-values, and false discovery rates. Ignoring the problem — by analyzing only complete cases or by relying on a default imputation strategy without evaluation — introduces systematic bias whose direction and magnitude depend on the underlying missingness mechanism (Lazar et al., 2016).</p>
<p>The statistical framework for missing data distinguishes three mechanisms: values missing completely at random (MCAR), missing at random (MAR), and missing not at random (MNAR). In proteomics, MNAR is particularly important because it encompasses the dominant mode of data loss in mass spectrometry: peptides whose abundance falls below the detection limit produce no measurable signal, creating a systematic association between low intensity and missingness (Webb-Robertson et al., 2015).</p>
<p>DIA-MS acquires fragmentation spectra across the entire precursor mass range in each cycle, substantially reducing the stochastic missingness that plagues DDA. In DDA, the mass spectrometer selects a limited number of precursors per scan cycle, generating MAR-like missingness independent of peptide abundance. DIA eliminates this randomness by fragmenting all precursors within predefined isolation windows. The practical consequence is that missing values in DIA data are overwhelmingly MNAR — they arise because the peptide was genuinely below quantification threshold, not because the instrument selected other precursors (Kong et al., 2022).</p>
<p>This distinction has direct implications for method selection. MAR-focused methods (knn, bpca) exploit the correlation structure among observed values but systematically overestimate truly low-abundance missing entries because they predict from the center of the observed distribution (Lazar et al., 2016). MNAR-focused methods (MinProb, QRILC) draw replacement values from the lower tail, appropriately modeling below-detection censoring but underestimating values that are genuinely MAR (Webb-Robertson et al., 2015).</p>
<p>Because real datasets contain a mixture of both mechanisms, a single method applied uniformly is unlikely to be optimal. The mixed-imputation approach addresses this by first classifying each protein as MAR or MNAR, then applying the appropriate method to each subset (Lazar et al., 2016). Whether a mixed approach outperforms a well-chosen single method depends on the proportion of MAR versus MNAR proteins and the accuracy of the classification.</p>
<p>Given this complexity, benchmarking is essential. There is no universally best imputation method; the optimal choice depends on the missingness pattern, data structure, and downstream goals. A method that minimizes reconstruction error on one dataset may fail on another with different characteristics. Dataset-specific evaluation is the only reliable way to make this determination (Jin et al., 2021).</p>
<p>Our pipeline proceeds in three stages: (1) classify each protein as MAR or MNAR using msImpute <code>selectFeatures</code>; (2) benchmark 14 methods using NRMSE on 10% masked values across 20 iterations; (3) apply the best method and audit imputation quality. The distinction between benchmarking and blind application is consequential — many pipelines apply a default without evaluating appropriateness, which is problematic for mixed-mechanism datasets (Harris et al., 2023).</p>
<p>The imputation step sits between normalization (stage 01) and differential expression (stage 04). Its outputs feed into a sensitivity analysis (stage 03) that compares results across normalization and imputation combinations, providing an additional check on whether the imputation choice materially affects biological conclusions.</p>
<p>The CvH study compares cancer survivors (CR) who completed 12 weeks of resistance training against healthy age-matched controls (PPS), with CR participants randomized to creatine or placebo. Vastus lateralis biopsies were collected at baseline (T1) and post-training (T2) for CR, and at a single timepoint for controls. Condition-specific proteins may be systematically missing in one group, reinforcing the expectation that MNAR dominates the missingness pattern.</p>
</section>
<section id="sec-classification" class="level1">
<h1>2 – MAR/MNAR Classification</h1>
<p>Before selecting an imputation method, it is important to characterize the missingness mechanism. The distinction between MAR and MNAR determines which class of method is appropriate, and applying the wrong class introduces systematic bias whose direction is predictable from the mismatch (Lazar et al., 2016).</p>
<p>The msImpute package provides <code>selectFeatures</code>, which fits an evidence-based model (EBM) to distinguish proteins whose missingness pattern is consistent with random dropout (MAR) from those consistent with abundance-dependent censoring (MNAR). The function evaluates whether missing value patterns can be explained by observed intensity structure or require a left-censoring model (Wei et al., 2018).</p>
<p>When <code>selectFeatures</code> fails — due to insufficient patterns for model fitting — the pipeline falls back to an intensity heuristic: proteins with &gt;30% missingness and below-median intensity, or &gt;50% missingness regardless of intensity, are classified as MNAR. This heuristic captures the well-documented inverse relationship between abundance and missingness (Webb-Robertson et al., 2015). Proteins with no missing values are classified as Complete.</p>
<p>The classification serves two purposes. First, it informs the mixed imputation methods in the benchmark, which apply different algorithms to the MAR and MNAR subsets. Second, it provides interpretive context: if the dataset is predominantly MNAR, we expect MNAR-focused or hybrid methods to outperform pure MAR methods (Lazar et al., 2016).</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>miss_class <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">file.path</span>(data_dir, <span class="st">"mar_mnar_classification.csv"</span>),</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>class_summary <span class="ot">&lt;-</span> miss_class <span class="sc">%&gt;%</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(class) <span class="sc">%&gt;%</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pct =</span> <span class="fu">round</span>(n <span class="sc">/</span> <span class="fu">sum</span>(n) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(class_summary,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Class"</span>, <span class="st">"N Proteins"</span>, <span class="st">"% of Total"</span>),</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"MAR/MNAR classification summary"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>MAR/MNAR classification summary</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Class</th>
<th style="text-align: right;">N Proteins</th>
<th style="text-align: right;">% of Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Complete</td>
<td style="text-align: right;">821</td>
<td style="text-align: right;">44.9</td>
</tr>
<tr class="even">
<td style="text-align: left;">MAR</td>
<td style="text-align: right;">508</td>
<td style="text-align: right;">27.8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MNAR</td>
<td style="text-align: right;">500</td>
<td style="text-align: right;">27.3</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The donut chart below provides a visual summary of the classification breakdown. Each slice represents the proportion of proteins assigned to one of three categories: Complete (no missing values), MAR (missingness unrelated to abundance), or MNAR (missingness driven by low abundance). The relative sizes immediately convey whether the dataset is dominated by one mechanism, which in turn guides expectations for benchmark results.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>donut_df <span class="ot">&lt;-</span> class_summary <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">fraction =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n),</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymax     =</span> <span class="fu">cumsum</span>(fraction),</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin     =</span> <span class="fu">lag</span>(ymax, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">label_y  =</span> (ymin <span class="sc">+</span> ymax) <span class="sc">/</span> <span class="dv">2</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">label    =</span> <span class="fu">paste0</span>(class, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, n, <span class="st">" ("</span>, pct, <span class="st">"%)"</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(donut_df, <span class="fu">aes</span>(<span class="at">ymax =</span> ymax, <span class="at">ymin =</span> ymin, <span class="at">xmax =</span> <span class="dv">4</span>, <span class="at">xmin =</span> <span class="fl">2.5</span>, <span class="at">fill =</span> class)) <span class="sc">+</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">alpha =</span> <span class="fl">0.85</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fl">3.25</span>, <span class="at">y =</span> label_y, <span class="at">label =</span> label), <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal_donut) <span class="sc">+</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">4.5</span>)) <span class="sc">+</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"MAR / MNAR Classification of Proteins"</span>,</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Class"</span>) <span class="sc">+</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="CvH_imputation_files/figure-html/donut-chart-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>Proportion of proteins classified as Complete, MAR, or MNAR</figcaption>
</figure>
</div>
</div>
</div>
<p>The plot below shows the relationship between a protein’s average observed intensity and the percentage of samples in which it is missing. Proteins that are abundant tend to be detected reliably across all samples, while low-abundance proteins are more frequently missing. This pattern is the hallmark of MNAR missingness: values are absent precisely because the protein’s signal falls below the instrument’s detection limit, not by random chance. The loess smooth line highlights this trend.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>miss_scatter <span class="ot">&lt;-</span> miss_class <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(mean_int), <span class="sc">!</span><span class="fu">is.na</span>(pct_miss))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(miss_scatter, <span class="fu">aes</span>(<span class="at">x =</span> mean_int, <span class="at">y =</span> pct_miss, <span class="at">color =</span> class)) <span class="sc">+</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.55</span>, <span class="at">size =</span> <span class="fl">1.8</span>) <span class="sc">+</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"grey30"</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">linewidth =</span> <span class="fl">0.8</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> pal_mar) <span class="sc">+</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Mean observed intensity (log2)"</span>,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"% missing values"</span>,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Missingness increases as protein abundance decreases"</span>,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Class"</span>) <span class="sc">+</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="CvH_imputation_files/figure-html/missingness-vs-intensity-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>Protein missingness percentage versus mean observed intensity, colored by MAR/MNAR class</figcaption>
</figure>
</div>
</div>
</div>
<p>The bar chart below shows how many values are observed versus missing in each individual sample. This sample-level view complements the protein-level classification above. Samples with unusually high missingness may indicate technical issues (poor digestion, low loading), while consistent missingness across samples supports a protein-driven (MNAR) explanation. Bars are ordered by biological group so that patterns within and between conditions are visible.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>norm_mat <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">file.path</span>(norm_dir, <span class="st">"01_normalized.csv"</span>),</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>meta     <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(meta_path, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify sample columns (exclude annotation columns)</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>sample_cols <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(norm_mat),</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">c</span>(<span class="st">"uniprot_id"</span>, <span class="st">"protein"</span>, <span class="st">"gene"</span>, <span class="st">"description"</span>, <span class="st">"n_seq"</span>))</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>sample_miss <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">Col_ID   =</span> sample_cols,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_miss   =</span> <span class="fu">colSums</span>(<span class="fu">is.na</span>(norm_mat[, sample_cols])),</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_obs    =</span> <span class="fu">nrow</span>(norm_mat) <span class="sc">-</span> <span class="fu">colSums</span>(<span class="fu">is.na</span>(norm_mat[, sample_cols]))</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(meta <span class="sc">%&gt;%</span> <span class="fu">select</span>(Col_ID, Group_Time), <span class="at">by =</span> <span class="st">"Col_ID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">BioGroup =</span> <span class="fu">case_when</span>(</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    Group_Time <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"CRE_T1"</span>, <span class="st">"PLA_T1"</span>) <span class="sc">~</span> <span class="st">"CR_T1"</span>,</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    Group_Time <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"CRE_T2"</span>, <span class="st">"PLA_T2"</span>) <span class="sc">~</span> <span class="st">"CR_T2"</span>,</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    Group_Time <span class="sc">==</span> <span class="st">"H_T1"</span>                   <span class="sc">~</span> <span class="st">"PPS_T1"</span>,</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span>                                   <span class="sc">~</span> Group_Time</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(BioGroup, Col_ID)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>sample_miss_long <span class="ot">&lt;-</span> sample_miss <span class="sc">%&gt;%</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(n_obs, n_miss),</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"status"</span>, <span class="at">values_to =</span> <span class="st">"count"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">status =</span> <span class="fu">factor</span>(status, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"n_obs"</span>, <span class="st">"n_miss"</span>),</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>                         <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Observed"</span>, <span class="st">"Missing"</span>)),</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">Col_ID =</span> <span class="fu">factor</span>(Col_ID, <span class="at">levels =</span> sample_miss<span class="sc">$</span>Col_ID))</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sample_miss_long, <span class="fu">aes</span>(<span class="at">x =</span> Col_ID, <span class="at">y =</span> count, <span class="at">fill =</span> status)) <span class="sc">+</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">Observed =</span> <span class="st">"#4393C3"</span>, <span class="at">Missing =</span> <span class="st">"#D6604D"</span>)) <span class="sc">+</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Number of proteins"</span>,</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Per-sample observed vs. missing protein counts"</span>,</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">60</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">7</span>),</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="CvH_imputation_files/figure-html/sample-missingness-bar-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>Per-sample observed and missing value counts, ordered by biological group</figcaption>
</figure>
</div>
</div>
</div>
<p>For DIA-MS data, we expect the MNAR fraction to dominate among proteins with missing values, since the primary source of data loss is peptide abundance falling below the detection limit rather than stochastic precursor selection. If the MNAR fraction substantially exceeds MAR, this confirms alignment with the expected left-censoring model. The relative proportions also inform benchmark expectations: an MNAR-dominated dataset should favor methods drawing from the lower intensity tail.</p>
<p>The intensity distributions of MAR versus MNAR proteins should show clear separation, with MNAR proteins having lower mean observed intensity. This validates the classification — identical distributions would render the distinction meaningless. The scatter plot above confirms this separation visually.</p>
<p>Understanding the classification contextualizes the downstream quality audit. MNAR-classified proteins will receive imputed values from the left tail of their distribution, shifting their mean downward. This shift should be small (Cohen’s d &lt; 0.2 for most proteins) if the imputation is well-calibrated, but proteins with high missingness will inevitably show larger shifts because more of their values are replaced (Wei et al., 2018).</p>
</section>
<section id="sec-benchmark-design" class="level1">
<h1>3 – Benchmark Design and Rationale</h1>
<p>Selecting an imputation method without benchmarking is equivalent to choosing a statistical model without checking assumptions. Our benchmark evaluates 14 candidate methods to identify which best reconstructs artificially masked observed values in this specific dataset.</p>
<p>The 14 methods span three categories. Three MNAR-focused methods draw from left-censored distributions: MinProb samples from a Gaussian centered at the lowest quantile, MinDet uses the minimum observed value, and QRILC fits a truncated Gaussian per protein. These are appropriate when missing values represent below-detection measurements (Lazar et al., 2016).</p>
<p>Four MAR-focused methods exploit correlation structure: knn imputes from weighted averages of similar proteins, bpca uses probabilistic PCA, MLE fits a multivariate Gaussian, and RF trains decision tree ensembles. These assume missingness is unrelated to abundance (Webb-Robertson et al., 2015).</p>
<p>Seven mixed methods combine one MAR and one MNAR method, applying each to its classified protein subset: knn+MinProb, knn+MinDet, knn+QRILC, bpca+MinProb, bpca+QRILC, RF+MinProb, and RF+QRILC. This tests whether mechanism-aware imputation outperforms uniform application (Lazar et al., 2016).</p>
<p>The benchmark masks 10% of observed values, imputes the full matrix, and compares imputed values at masked positions to the known truth. This masking rate balances stable error estimates against preserving enough observed values for imputation algorithms to function (Jin et al., 2021).</p>
<p>Reconstruction accuracy is measured by NRMSE (RMSE / SD of true values), a scale-invariant metric that directly quantifies reconstruction accuracy. Values near zero indicate near-perfect recovery; values near 1.0 indicate error comparable to natural variability (Jin et al., 2021).</p>
<p>The masking procedure is repeated 20 times with different random masks (seed = 42) to obtain stable distributions. During masking, proteins gaining additional missingness are temporarily reclassified to prevent MNAR methods from being evaluated on artificially masked high-abundance values.</p>
<p>The design intentionally includes methods expected to perform poorly under certain conditions because negative results are informative. If a pure MNAR method outperforms all others, it provides strong evidence of predominantly left-censored missingness. If a mixed method wins, the classification captures meaningful mechanistic heterogeneity (Harris et al., 2023).</p>
<p>Only the best-performing method (by mean NRMSE) is applied to the full dataset. The sensitivity analysis in stage 03 tests whether alternative strategies would change biological conclusions. No single method consistently outperforms all others across datasets (Jin et al., 2021; Harris et al., 2023), which is precisely why dataset-specific benchmarking is essential.</p>
</section>
<section id="sec-benchmark-results" class="level1">
<h1>4 – Benchmark Results and Interpretation</h1>
<p>The benchmark summary from <code>CvH_imputation_run.R</code> contains mean, standard deviation, and median NRMSE for each of the 14 methods across 20 masking iterations.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>bench <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">file.path</span>(data_dir, <span class="st">"benchmark_summary.csv"</span>),</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>bench <span class="ot">&lt;-</span> bench <span class="sc">%&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    method <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"MinProb"</span>, <span class="st">"MinDet"</span>, <span class="st">"QRILC"</span>) <span class="sc">~</span> <span class="st">"MNAR"</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    method <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"knn"</span>, <span class="st">"bpca"</span>, <span class="st">"MLE"</span>, <span class="st">"RF"</span>)   <span class="sc">~</span> <span class="st">"MAR"</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span>                                         <span class="sc">~</span> <span class="st">"Hybrid"</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(mean)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(bench,</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">digits =</span> <span class="dv">4</span>,</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Method"</span>, <span class="st">"Mean NRMSE"</span>, <span class="st">"SD"</span>, <span class="st">"Median NRMSE"</span>, <span class="st">"Type"</span>),</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Benchmark results: 14 imputation methods ranked by mean NRMSE (20 iterations, 10% masking)"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Benchmark results: 14 imputation methods ranked by mean NRMSE (20 iterations, 10% masking)</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Method</th>
<th style="text-align: right;">Mean NRMSE</th>
<th style="text-align: right;">SD</th>
<th style="text-align: right;">Median NRMSE</th>
<th style="text-align: left;">Type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">bpca</td>
<td style="text-align: right;">0.1612</td>
<td style="text-align: right;">0.0029</td>
<td style="text-align: right;">0.1612</td>
<td style="text-align: left;">MAR</td>
</tr>
<tr class="even">
<td style="text-align: left;">RF</td>
<td style="text-align: right;">0.1747</td>
<td style="text-align: right;">0.0033</td>
<td style="text-align: right;">0.1741</td>
<td style="text-align: left;">MAR</td>
</tr>
<tr class="odd">
<td style="text-align: left;">knn</td>
<td style="text-align: right;">0.2300</td>
<td style="text-align: right;">0.0414</td>
<td style="text-align: right;">0.2025</td>
<td style="text-align: left;">MAR</td>
</tr>
<tr class="even">
<td style="text-align: left;">mix_knn_MinDet</td>
<td style="text-align: right;">0.6083</td>
<td style="text-align: right;">0.0064</td>
<td style="text-align: right;">0.6091</td>
<td style="text-align: left;">Hybrid</td>
</tr>
<tr class="odd">
<td style="text-align: left;">mix_knn_QRILC</td>
<td style="text-align: right;">0.6481</td>
<td style="text-align: right;">0.0105</td>
<td style="text-align: right;">0.6477</td>
<td style="text-align: left;">Hybrid</td>
</tr>
<tr class="even">
<td style="text-align: left;">mix_bpca_QRILC</td>
<td style="text-align: right;">0.6485</td>
<td style="text-align: right;">0.0099</td>
<td style="text-align: right;">0.6507</td>
<td style="text-align: left;">Hybrid</td>
</tr>
<tr class="odd">
<td style="text-align: left;">mix_RF_QRILC</td>
<td style="text-align: right;">0.6486</td>
<td style="text-align: right;">0.0110</td>
<td style="text-align: right;">0.6498</td>
<td style="text-align: left;">Hybrid</td>
</tr>
<tr class="even">
<td style="text-align: left;">mix_RF_MinProb</td>
<td style="text-align: right;">1.1530</td>
<td style="text-align: right;">0.0153</td>
<td style="text-align: right;">1.1550</td>
<td style="text-align: left;">Hybrid</td>
</tr>
<tr class="odd">
<td style="text-align: left;">mix_bpca_MinProb</td>
<td style="text-align: right;">1.1592</td>
<td style="text-align: right;">0.0114</td>
<td style="text-align: right;">1.1560</td>
<td style="text-align: left;">Hybrid</td>
</tr>
<tr class="even">
<td style="text-align: left;">mix_knn_MinProb</td>
<td style="text-align: right;">1.1594</td>
<td style="text-align: right;">0.0153</td>
<td style="text-align: right;">1.1568</td>
<td style="text-align: left;">Hybrid</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MinDet</td>
<td style="text-align: right;">2.1326</td>
<td style="text-align: right;">0.0101</td>
<td style="text-align: right;">2.1311</td>
<td style="text-align: left;">MNAR</td>
</tr>
<tr class="even">
<td style="text-align: left;">MinProb</td>
<td style="text-align: right;">2.1417</td>
<td style="text-align: right;">0.0100</td>
<td style="text-align: right;">2.1411</td>
<td style="text-align: left;">MNAR</td>
</tr>
<tr class="odd">
<td style="text-align: left;">QRILC</td>
<td style="text-align: right;">2.5567</td>
<td style="text-align: right;">0.0149</td>
<td style="text-align: right;">2.5578</td>
<td style="text-align: left;">MNAR</td>
</tr>
<tr class="even">
<td style="text-align: left;">MLE</td>
<td style="text-align: right;">229.3889</td>
<td style="text-align: right;">4.3690</td>
<td style="text-align: right;">229.5137</td>
<td style="text-align: left;">MAR</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>bench_plot <span class="ot">&lt;-</span> bench <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="fu">factor</span>(method, <span class="at">levels =</span> method))</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bench_plot, <span class="fu">aes</span>(<span class="at">x =</span> method, <span class="at">y =</span> mean, <span class="at">fill =</span> type)) <span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">width =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> mean <span class="sc">-</span> sd, <span class="at">ymax =</span> mean <span class="sc">+</span> sd),</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">width =</span> <span class="fl">0.25</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">MNAR =</span> <span class="st">"#D6604D"</span>, <span class="at">MAR =</span> <span class="st">"#4393C3"</span>, <span class="at">Hybrid =</span> <span class="st">"#5AAE61"</span>)) <span class="sc">+</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Mean NRMSE"</span>,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Imputation benchmark: Mean NRMSE by method"</span>,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Method type"</span>) <span class="sc">+</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="CvH_imputation_files/figure-html/benchmark-barplot-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>Mean NRMSE across 14 imputation methods with standard deviation error bars</figcaption>
</figure>
</div>
</div>
</div>
<p>The ranking reveals whether single-mechanism or mixed-mechanism methods are better suited to this dataset. If a pure MNAR method ranks first, it suggests the dominant missingness is abundance-dependent left censoring and that correlation structure provides insufficient additional information. If a mixed method wins, the MAR/MNAR classification captures genuine heterogeneity that improves reconstruction (Lazar et al., 2016).</p>
<p>The standard deviation across iterations reflects method stability. A method with low mean but high SD may be sensitive to the specific masking pattern. The ideal method combines low mean NRMSE with low SD, indicating both accurate and consistent reconstruction.</p>
<p>Methods with very high NRMSE (above 1.0) are effectively worse than random noise and serve as negative controls. The spread between the best and worst methods quantifies the stakes of imputation method selection: a large spread means a default choice without benchmarking risks substantial bias.</p>
<p>The benchmark bar plot above provides detail on within-method variability. Regardless of which method wins, the benchmark provides the empirical justification for the imputation choice applied in the R script.</p>
</section>
<section id="sec-audit" class="level1">
<h1>5 – Imputation Quality Audit</h1>
<p>Selecting the best method by benchmark NRMSE is necessary but not sufficient. The benchmark evaluates reconstruction of artificially masked observed values, which are not truly missing. The actual missing values are predominantly low-abundance proteins below the detection limit, whereas masked values are drawn from the full observed distribution. The quality audit examines whether imputation produces a biologically plausible result on the real missing values.</p>
<p>The audit evaluates three dimensions: (1) per-protein effect sizes (Cohen’s d) quantifying how much imputation shifts each protein’s mean; (2) the relationship between effect size and missingness percentage; and (3) PCA and sample-level diagnostics assessing preservation of biological group structure.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>audit <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">file.path</span>(data_dir, <span class="st">"imputation_effect_audit.csv"</span>),</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>audit_stats <span class="ot">&lt;-</span> audit <span class="sc">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_proteins   =</span> <span class="fu">n</span>(),</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_d     =</span> <span class="fu">round</span>(<span class="fu">median</span>(effect_d, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">4</span>),</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_d       =</span> <span class="fu">round</span>(<span class="fu">mean</span>(effect_d, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">4</span>),</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_d         =</span> <span class="fu">round</span>(<span class="fu">sd</span>(effect_d, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">4</span>),</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">q25_d        =</span> <span class="fu">round</span>(<span class="fu">quantile</span>(effect_d, <span class="fl">0.25</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">4</span>),</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">q75_d        =</span> <span class="fu">round</span>(<span class="fu">quantile</span>(effect_d, <span class="fl">0.75</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">4</span>),</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_small    =</span> <span class="fu">round</span>(<span class="fu">mean</span>(<span class="fu">abs</span>(effect_d) <span class="sc">&lt;</span> <span class="fl">0.2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>),</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_medium   =</span> <span class="fu">round</span>(<span class="fu">mean</span>(<span class="fu">abs</span>(effect_d) <span class="sc">&gt;=</span> <span class="fl">0.2</span> <span class="sc">&amp;</span> <span class="fu">abs</span>(effect_d) <span class="sc">&lt;</span> <span class="fl">0.5</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>),</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_large    =</span> <span class="fu">round</span>(<span class="fu">mean</span>(<span class="fu">abs</span>(effect_d) <span class="sc">&gt;=</span> <span class="fl">0.5</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">t</span>(audit_stats),</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">col.names =</span> <span class="st">"Value"</span>,</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Summary of per-protein imputation effect sizes (Cohen's d)"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Summary of per-protein imputation effect sizes (Cohen’s d)</caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">n_proteins</td>
<td style="text-align: right;">1008.0000</td>
</tr>
<tr class="even">
<td style="text-align: left;">median_d</td>
<td style="text-align: right;">-0.0671</td>
</tr>
<tr class="odd">
<td style="text-align: left;">mean_d</td>
<td style="text-align: right;">-0.0907</td>
</tr>
<tr class="even">
<td style="text-align: left;">sd_d</td>
<td style="text-align: right;">0.1168</td>
</tr>
<tr class="odd">
<td style="text-align: left;">q25_d</td>
<td style="text-align: right;">-0.1416</td>
</tr>
<tr class="even">
<td style="text-align: left;">q75_d</td>
<td style="text-align: right;">-0.0181</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pct_small</td>
<td style="text-align: right;">84.6000</td>
</tr>
<tr class="even">
<td style="text-align: left;">pct_medium</td>
<td style="text-align: right;">14.6000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pct_large</td>
<td style="text-align: right;">0.8000</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Proteins with higher missingness are expected to show larger effect sizes because a greater fraction of their values are replaced. The reference lines at d = +/-0.2 mark the conventional threshold for a small effect.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(audit, <span class="fu">aes</span>(<span class="at">x =</span> pct_miss, <span class="at">y =</span> effect_d)) <span class="sc">+</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="fl">1.2</span>, <span class="at">color =</span> <span class="st">"#4393C3"</span>) <span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.2</span>, <span class="fl">0.2</span>), <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">color =</span> <span class="st">"grey50"</span>) <span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">max</span>(audit<span class="sc">$</span>pct_miss, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="fl">0.85</span>, <span class="at">y =</span> <span class="fl">0.22</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"|d| = 0.2 (small effect)"</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"% missing values"</span>, <span class="at">y =</span> <span class="st">"Effect size (Cohen's d)"</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Per-protein imputation effect: shift / pre-imputation SD"</span>) <span class="sc">+</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="CvH_imputation_files/figure-html/audit-scatter-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>Imputation effect size (Cohen’s d) versus percent missingness per protein</figcaption>
</figure>
</div>
</div>
</div>
<p>A distribution centered near zero with most values within the +/-0.2 band indicates the imputation preserves original intensity structure. A negative skew is expected for MNAR-focused methods, which pull post-imputation means downward.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(audit, <span class="fu">aes</span>(<span class="at">x =</span> effect_d)) <span class="sc">+</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">50</span>, <span class="at">fill =</span> <span class="st">"#4393C3"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.2</span>, <span class="fl">0.2</span>), <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">color =</span> <span class="st">"grey50"</span>) <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Cohen's d (imputation effect)"</span>, <span class="at">y =</span> <span class="st">"Count"</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Distribution of imputation effect sizes across proteins"</span>) <span class="sc">+</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="CvH_imputation_files/figure-html/audit-histogram-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>Distribution of per-protein imputation effect sizes (Cohen’s d)</figcaption>
</figure>
</div>
</div>
</div>
<p>Cohen’s d below 0.2 is conventionally a small effect — the shift is less than one-fifth of the natural variability. If the vast majority of proteins fall within this band, imputation is unlikely to distort downstream differential expression. Proteins exceeding |d| = 0.5 warrant scrutiny, as the imputation may have substantially altered their intensity distribution.</p>
<p>For MNAR-focused methods, we expect a negative correlation between effect size and missingness: more missing values means more imputed left-tail draws, producing larger downward shifts. A linear relationship indicates consistent behavior; nonlinearity could signal model misspecification.</p>
<p>The plot below shows PCA projections of the protein intensity matrix before and after imputation, side by side. PCA reduces the high-dimensional protein data to two summary axes that capture the largest sources of variation. If imputation is well-behaved, the biological group structure (CR at baseline, CR post-training, and healthy controls) should be preserved: groups that were separated before imputation should remain separated, and their relative positions should not shift. Artifactual clustering introduced by imputation would appear as groups merging or new separations appearing that were not present in the pre-imputation projection.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read pre- and post-imputation matrices</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>pre_mat  <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">file.path</span>(norm_dir, <span class="st">"01_normalized.csv"</span>),</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>post_mat <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">file.path</span>(data_dir, <span class="st">"01_imputed.csv"</span>),</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>meta_pca <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(meta_path, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>sample_cols_pca <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(pre_mat),</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">c</span>(<span class="st">"uniprot_id"</span>, <span class="st">"protein"</span>, <span class="st">"gene"</span>, <span class="st">"description"</span>, <span class="st">"n_seq"</span>))</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper: compute PCA scores from a wide protein matrix</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>run_pca <span class="ot">&lt;-</span> <span class="cf">function</span>(mat, samp_cols, <span class="at">fill_na =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  m <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(mat[, samp_cols])</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (fill_na) {</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Median-fill per protein for pre-imputation</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    row_med <span class="ot">&lt;-</span> <span class="fu">apply</span>(m, <span class="dv">1</span>, median, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">ncol</span>(m))) {</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>      nas <span class="ot">&lt;-</span> <span class="fu">is.na</span>(m[, j])</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>      m[nas, j] <span class="ot">&lt;-</span> row_med[nas]</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  pca <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(<span class="fu">t</span>(m), <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale. =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  scores <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(pca<span class="sc">$</span>x[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  scores<span class="sc">$</span>Col_ID <span class="ot">&lt;-</span> samp_cols</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  var_exp <span class="ot">&lt;-</span> <span class="fu">summary</span>(pca)<span class="sc">$</span>importance[<span class="dv">2</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">scores =</span> scores, <span class="at">var_exp =</span> var_exp)</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>pca_pre  <span class="ot">&lt;-</span> <span class="fu">run_pca</span>(pre_mat,  sample_cols_pca, <span class="at">fill_na =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>pca_post <span class="ot">&lt;-</span> <span class="fu">run_pca</span>(post_mat, sample_cols_pca, <span class="at">fill_na =</span> <span class="cn">FALSE</span>)</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Attach BioGroup</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>attach_bio <span class="ot">&lt;-</span> <span class="cf">function</span>(scores_df, meta_df) {</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>  scores_df <span class="sc">%&gt;%</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(meta_df <span class="sc">%&gt;%</span> <span class="fu">select</span>(Col_ID, Group_Time), <span class="at">by =</span> <span class="st">"Col_ID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">BioGroup =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>      Group_Time <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"CRE_T1"</span>, <span class="st">"PLA_T1"</span>) <span class="sc">~</span> <span class="st">"CR_T1"</span>,</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>      Group_Time <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"CRE_T2"</span>, <span class="st">"PLA_T2"</span>) <span class="sc">~</span> <span class="st">"CR_T2"</span>,</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>      Group_Time <span class="sc">==</span> <span class="st">"H_T1"</span>                   <span class="sc">~</span> <span class="st">"PPS_T1"</span>,</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span>                                   <span class="sc">~</span> Group_Time</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>pre_scores  <span class="ot">&lt;-</span> <span class="fu">attach_bio</span>(pca_pre<span class="sc">$</span>scores,  meta_pca)</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>post_scores <span class="ot">&lt;-</span> <span class="fu">attach_bio</span>(pca_post<span class="sc">$</span>scores, meta_pca)</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>p_pre <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pre_scores, <span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2, <span class="at">color =</span> BioGroup)) <span class="sc">+</span></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="at">level =</span> <span class="fl">0.68</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> pal_bio) <span class="sc">+</span></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">paste0</span>(<span class="st">"PC1 ("</span>, <span class="fu">round</span>(pca_pre<span class="sc">$</span>var_exp[<span class="dv">1</span>], <span class="dv">1</span>), <span class="st">"%)"</span>),</span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">paste0</span>(<span class="st">"PC2 ("</span>, <span class="fu">round</span>(pca_pre<span class="sc">$</span>var_exp[<span class="dv">2</span>], <span class="dv">1</span>), <span class="st">"%)"</span>),</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Pre-imputation (median-filled)"</span>,</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Group"</span>) <span class="sc">+</span></span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">11</span>) <span class="sc">+</span></span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>p_post <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(post_scores, <span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2, <span class="at">color =</span> BioGroup)) <span class="sc">+</span></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="at">level =</span> <span class="fl">0.68</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> pal_bio) <span class="sc">+</span></span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">paste0</span>(<span class="st">"PC1 ("</span>, <span class="fu">round</span>(pca_post<span class="sc">$</span>var_exp[<span class="dv">1</span>], <span class="dv">1</span>), <span class="st">"%)"</span>),</span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">paste0</span>(<span class="st">"PC2 ("</span>, <span class="fu">round</span>(pca_post<span class="sc">$</span>var_exp[<span class="dv">2</span>], <span class="dv">1</span>), <span class="st">"%)"</span>),</span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Post-imputation"</span>,</span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Group"</span>) <span class="sc">+</span></span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">11</span>) <span class="sc">+</span></span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>p_pre <span class="sc">+</span> p_post <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">"collect"</span>) <span class="sc">&amp;</span></span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="CvH_imputation_files/figure-html/pca-pre-post-1.png" class="img-fluid figure-img" width="1344"></p>
<figcaption>PCA of protein intensities before (left) and after (right) imputation, colored by biological group</figcaption>
</figure>
</div>
</div>
</div>
<p>The plot below overlays the intensity distributions of observed values (from the pre-imputation matrix) and imputed values (values that were missing before imputation but present after). For MNAR-focused methods, imputed values are expected to appear as a secondary peak or shoulder in the lower tail of the intensity distribution, reflecting the assumption that missing proteins were below the detection limit. If the imputed values overlap substantially with the observed distribution rather than sitting below it, the method may be overestimating missing values — a sign that an MAR method was applied to MNAR data.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>pre_long  <span class="ot">&lt;-</span> pre_mat  <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">all_of</span>(sample_cols_pca),</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"sample"</span>, <span class="at">values_to =</span> <span class="st">"intensity_pre"</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>post_long <span class="ot">&lt;-</span> post_mat <span class="sc">%&gt;%</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">all_of</span>(sample_cols_pca),</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"sample"</span>, <span class="at">values_to =</span> <span class="st">"intensity_post"</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>combined <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  pre_long  <span class="sc">%&gt;%</span> <span class="fu">select</span>(gene, sample, intensity_pre),</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  post_long <span class="sc">%&gt;%</span> <span class="fu">select</span>(intensity_post)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>observed_vals <span class="ot">&lt;-</span> combined <span class="sc">%&gt;%</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(intensity_pre)) <span class="sc">%&gt;%</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">intensity =</span> intensity_pre, <span class="at">source =</span> <span class="st">"Observed"</span>)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>imputed_vals <span class="ot">&lt;-</span> combined <span class="sc">%&gt;%</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(intensity_pre) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(intensity_post)) <span class="sc">%&gt;%</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">intensity =</span> intensity_post, <span class="at">source =</span> <span class="st">"Imputed"</span>)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>overlay_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(observed_vals, imputed_vals)</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(overlay_df, <span class="fu">aes</span>(<span class="at">x =</span> intensity, <span class="at">fill =</span> source)) <span class="sc">+</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">after_stat</span>(density)), <span class="at">bins =</span> <span class="dv">80</span>,</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>                 <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">position =</span> <span class="st">"identity"</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">Observed =</span> <span class="st">"#4393C3"</span>, <span class="at">Imputed =</span> <span class="st">"#D6604D"</span>)) <span class="sc">+</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Log2 intensity"</span>, <span class="at">y =</span> <span class="st">"Density"</span>,</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Observed vs. imputed intensity distributions"</span>,</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="CvH_imputation_files/figure-html/intensity-overlay-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>Intensity distribution: observed values versus imputed (filled-in) values</figcaption>
</figure>
</div>
</div>
</div>
<p>The plot below assesses whether imputation systematically shifts any sample’s overall intensity. For each sample, the mean log2 intensity is computed before and after imputation and plotted against the identity line (y = x). Points lying exactly on the identity line indicate zero net shift; points below it indicate the imputation lowered the sample mean (expected for MNAR methods that fill in low-tail values), and points above indicate an upward shift. Small, consistent downward deviations are expected and benign. Large or heterogeneous deviations would suggest the imputation is differentially affecting certain samples, which could introduce bias into group comparisons.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>pre_means <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(pre_mat[, sample_cols_pca], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>post_means <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(post_mat[, sample_cols_pca], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>shift_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Col_ID    =</span> sample_cols_pca,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">pre_mean  =</span> pre_means,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">post_mean =</span> post_means</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(meta_pca <span class="sc">%&gt;%</span> <span class="fu">select</span>(Col_ID, Group_Time), <span class="at">by =</span> <span class="st">"Col_ID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">BioGroup =</span> <span class="fu">case_when</span>(</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    Group_Time <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"CRE_T1"</span>, <span class="st">"PLA_T1"</span>) <span class="sc">~</span> <span class="st">"CR_T1"</span>,</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    Group_Time <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"CRE_T2"</span>, <span class="st">"PLA_T2"</span>) <span class="sc">~</span> <span class="st">"CR_T2"</span>,</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    Group_Time <span class="sc">==</span> <span class="st">"H_T1"</span>                   <span class="sc">~</span> <span class="st">"PPS_T1"</span>,</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span>                                   <span class="sc">~</span> Group_Time</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(shift_df, <span class="fu">aes</span>(<span class="at">x =</span> pre_mean, <span class="at">y =</span> post_mean, <span class="at">color =</span> BioGroup)) <span class="sc">+</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"grey50"</span>) <span class="sc">+</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> pal_bio) <span class="sc">+</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Pre-imputation sample mean (log2)"</span>,</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Post-imputation sample mean (log2)"</span>,</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Sample mean intensity: pre vs. post imputation"</span>,</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Group"</span>) <span class="sc">+</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="CvH_imputation_files/figure-html/sample-mean-shift-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>Pre- versus post-imputation sample means with identity line, colored by biological group</figcaption>
</figure>
</div>
</div>
</div>
<p>These diagnostics inform a binary decision: is the imputation trustworthy for downstream differential expression, or should we default to a non-imputed pathway? Trustworthy imputation shows: (1) most effect sizes below |d| = 0.2, (2) a monotonic effect-size/missingness relationship, (3) preserved PCA group structure, and (4) sample means near the identity line.</p>
<p>The quality audit operates at the global level and cannot detect whether specific biologically important proteins have been distorted. The sensitivity analysis in stage 03 addresses this by comparing differential expression results across multiple imputation strategies, identifying proteins whose significance is sensitive to the imputation decision.</p>
</section>
<section id="sec-conclusion" class="level1">
<h1>6 – Conclusion</h1>
<p>This document has presented the results of the CvH imputation pipeline, which classifies missingness mechanisms, benchmarks 14 imputation methods, applies the best-performing method, and audits imputation quality through multiple complementary diagnostics.</p>
<p>The MAR/MNAR classification provides the mechanistic foundation for method selection, confirming whether the missingness pattern aligns with the expected left-censoring model for DIA-MS data. The benchmark identifies the method that best reconstructs masked values, providing empirical justification. The quality audit evaluates whether the imputation preserves biological signal and quantifies per-protein effect sizes.</p>
<p>The imputed matrix (<code>01_imputed.csv</code>) serves as the primary input for differential expression in stage 04. The sensitivity analysis in stage 03 will compare results across a normalization-imputation grid to determine whether the choice materially affects final biological conclusions. If substantial discordance is found, the non-imputed pathway provides a conservative fallback avoiding imputation-induced bias at the cost of reduced power.</p>
</section>
<section id="sec-refs" class="level1">
<h1>References</h1>
<ol type="1">
<li><p>Lazar C, Gatto L, Ferro M, et al.&nbsp;(2016). Accounting for the multiple natures of missing values in label-free quantitative proteomics data sets to compare imputation strategies. <em>Journal of Proteome Research</em> 15(4):1116-1125.</p></li>
<li><p>Webb-Robertson BM, Wiber HK, Matzke MM, et al.&nbsp;(2015). Review, evaluation, and discussion of the challenges of missing value imputation for mass spectrometry-based label-free global proteomics. <em>Journal of Proteome Research</em> 14(3):920-930.</p></li>
<li><p>Kong W, Hui HWH, Peng H, et al.&nbsp;(2022). Dealing with missing values in proteomics data. <em>Proteomics</em> 23(23-24):e2200092.</p></li>
<li><p>Wei R, Wang J, Su M, et al.&nbsp;(2018). Missing value imputation approach for mass spectrometry-based metabolomics data. <em>Scientific Reports</em> 8:663.</p></li>
<li><p>Jin L, Bi Y, Hu C, et al.&nbsp;(2021). A comparative study of evaluating missing value imputation methods in label-free proteomics. <em>Scientific Reports</em> 11:1760.</p></li>
<li><p>Valikangas T, Suomi T, Elo LL (2018). A systematic evaluation of normalization methods in quantitative label-free proteomics. <em>Briefings in Bioinformatics</em> 19(1):1-11.</p></li>
<li><p>Harris L, Fondrie WE, Oh S, Noble WS (2023). Evaluating proteomics imputation methods with improved criteria. <em>Journal of Proteome Research</em> 22(11):3427-3438.</p></li>
<li><p>O’Brien JJ, Bhatt DK, Engel JM, et al.&nbsp;(2018). Label-free quantitative proteomics analysis with implications for missingness and filtering strategies. <em>Annals of Applied Statistics</em> 12(4):2484-2510.</p></li>
</ol>
</section>
<section id="sec-session" class="level1">
<h1>Session Info</h1>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.5.1 (2025-06-13)
Platform: aarch64-apple-darwin20
Running under: macOS Tahoe 26.2

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/lib/libRblas.0.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.1

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: America/Chicago
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] scales_1.4.0    here_1.0.2      patchwork_1.3.2 ggplot2_4.0.2  
[5] knitr_1.51      tidyr_1.3.2     dplyr_1.2.0     readr_2.1.6    

loaded via a namespace (and not attached):
 [1] Matrix_1.7-4       bit_4.6.0          gtable_0.3.6       jsonlite_2.0.0    
 [5] crayon_1.5.3       compiler_4.5.1     tidyselect_1.2.1   parallel_4.5.1    
 [9] splines_4.5.1      yaml_2.3.12        fastmap_1.2.0      lattice_0.22-9    
[13] R6_2.6.1           labeling_0.4.3     generics_0.1.4     MASS_7.3-65       
[17] htmlwidgets_1.6.4  tibble_3.3.1       rprojroot_2.1.1    pillar_1.11.1     
[21] RColorBrewer_1.1-3 tzdb_0.5.0         rlang_1.1.7        xfun_0.56         
[25] S7_0.2.1           bit64_4.6.0-1      otel_0.2.0         cli_3.6.5         
[29] mgcv_1.9-4         withr_3.0.2        magrittr_2.0.4     digest_0.6.39     
[33] grid_4.5.1         vroom_1.7.0        hms_1.1.4          nlme_3.1-168      
[37] lifecycle_1.0.5    vctrs_0.7.1        evaluate_1.0.5     glue_1.8.0        
[41] farver_2.1.2       pacman_0.5.1       rmarkdown_2.30     purrr_1.2.1       
[45] tools_4.5.1        pkgconfig_2.0.3    htmltools_0.5.9   </code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>